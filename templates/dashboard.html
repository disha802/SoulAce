<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>SoulAce - Your Mental Health Companion</title>
<style>
  body { margin:0; font-family:'Segoe UI', sans-serif; color:#333; transition: background 0.4s, color 0.4s; background: url("{{url_for('static', filename='dashboard bg.jpg')}}") no-repeat center center fixed; background-size: cover;}
  header { display:flex; justify-content:space-between; align-items:center; padding:10px 20px; background-color:#7B9B8B; }
  .header-left { display:flex; align-items:center; gap:15px; }
  .header-right { display:flex; align-items:center; gap:10px; }
  .header-text { display:flex; flex-direction:column; }
  .logo-container { width:60px; height:60px; }
  .logo-container img { width:60px; height:60px; border-radius:50%; object-fit:cover; }
  .logout-btn, .toggle-btn { padding:8px 12px; border:none; border-radius:8px; cursor:pointer; }
  header h1 { margin:0; font-size:1.8rem; color:#fff; }
  .header-text h3 { margin:0; font-size:1rem; font-weight:normal; color:#FFF7E4; }
  .user-icon-container { position:relative; }
  .user-icon { width:40px; height:40px; border-radius:50%; cursor:pointer; }
  .toggle-btn { background:#fff; border:2px solid #ccc; padding:0.4rem 0.8rem; border-radius:20px; cursor:pointer; font-size:0.9rem; transition: all 0.3s; }
  .toggle-btn:hover { background:#fcd58d; }
  .user-popup { display:none; position:absolute; top:50px; right:0; background:#fff; border-radius:12px; box-shadow:0 5px 15px rgba(0,0,0,0.2); padding:10px; z-index:100; min-width:160px; }
  .user-popup .popup-btn { display:block; width:100%; padding:8px; text-decoration:none; color:inherit; cursor:pointer; margin-bottom:5px; text-align:left; }
  .user-popup .popup-btn:hover { background:#f2f2f2; }

  .hero { text-align:center; padding:2rem 1rem; background:#F5F7F280; max-width: 800px; margin: 0 auto; border-radius:12px; }

  .hero h2 { font-size:2.2rem; margin-bottom:1rem; color:#243B36; }
  .hero p { font-size:1.1rem; max-width:600px; margin:0 auto; }
  .mood-tracker { text-align:center; margin:2rem 0; }
  .moods { display:flex; justify-content:center; gap:30px; flex-wrap:wrap; margin:20px; }
  .mood-option { display:flex; flex-direction:column; align-items:center; cursor:pointer; }
  .mood-btn { font-size:25px; cursor:pointer; border:2px solid #ccc; border-radius:50%; padding:10px; background:white; transition:0.2s; margin-bottom:8px; }
  .mood-btn:hover { border-color:#555; }
  .label { font-size:16px; font-weight:bold; }
  button, .popup-btn { background:linear-gradient(135deg, #657A74 , #243B36); color:#fff; font-size:16px; font-weight:600; padding:10px 18px; border:none; border-radius:8px; cursor:pointer; box-shadow:0 4px 6px rgba(0,0,0,0.2); transition:all 0.3s ease; }
  button:hover, .popup-btn:hover { background:linear-gradient(45deg, #657A74 , #243B36); transform:translateY(-2px); box-shadow:0 6px 10px rgba(0,0,0,0.25); }
  .features { display:grid; grid-template-columns:repeat(auto-fit, minmax(220px, 1fr)); gap:1.5rem; padding:2rem; }
  .feature-card { background:#fff; padding:1.5rem; border-radius:16px; text-align:center; box-shadow:0 2px 6px rgba(0,0,0,0.1); transition:transform 0.3s; display:block; text-decoration:none; color:inherit; }
  .feature-card:hover { transform:translateY(-5px); }
  .feature-card span img { width:80px; height:80px; object-fit:contain; display:block; margin:0 auto 0.5rem; }
  .feature-card p { color:#657A74; }
  .crisis-btn {position: fixed;
  bottom: 20px;          /* distance from bottom */
  right: 20px;           /* distance from right */
  background: linear-gradient(135deg, #e63946, #ff6b6b);
  color: white;
  border: none;
  border-radius: 50px;
  padding: 14px 28px;
  font-size: 16px;
  font-weight: bold;
  cursor: pointer;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
  transition: all 0.3s ease;
  z-index: 9999;         /* stays above other elements */
}

.crisis-btn:hover {
  background: linear-gradient(135deg, #ff4d4d, #ff8585);
  transform: scale(1.05);
}

  .feature-card h3 { margin:0.5rem 0; }
  .feature-card p { color:#657A74; margin:0; }
  footer { text-align:center; padding:1rem; font-size:0.9rem; background:#ffeecf; border-top:2px solid #fcd58d; margin-top:2rem; }

  body.dark { background:#121212; color:#e0e0e0; }
  body.dark header { background-color:#1f1f1f; color:#f9e6d0; }
  body.dark .header-text h3 { color:#ccc; }
  body.dark .logo-container img { border:2px solid #444; }
  body.dark .header-right { color:#f9e6d0; }
  body.dark .user-popup { background:#2a2a2a; color:#f9e6d0; border:1px solid #444; }
  body.dark .user-popup .popup-btn { color:#f9e6d0; }
  body.dark .toggle-btn { background:#444; color:#f9e6d0; border:1px solid #666; }
  body.dark .hero { background:#1f1f1f; color:#e0e0e0; }
  body.dark .feature-card { background:#2a2a2a; color:#e0e0e0; box-shadow:0 2px 6px rgba(0,0,0,0.5); }
  body.dark footer { background:#1f1f1f; color:#e0e0e0; border-top:2px solid #444; }
</style>
</head>
<body>

<header>
  <div class="header-left">
    <div class="logo-container">
      <img src="{{ url_for('static', filename='header-logo.png') }}" alt="SoulAce Logo">
    </div>
    <div class="header-text">
      <h1>SoulAce</h1>
      <h3>Wellness begins here.</h3>
    </div>
  </div>

  <div class="header-right">
    <div class="user-icon-container">
      <img src="{{ url_for('static', filename='user-icon.jpeg') }}" 
           alt="User Icon" class="user-icon" onclick="toggleUserPopup()">

      <div id="user-popup" class="user-popup">
        <!-- Google Translate -->
        <div id="google_translate_element" style="margin-bottom:10px;"></div>

        <button onclick="toggleMode()" class="popup-btn">Change Mode</button>
        <form action="{{ url_for('logout') }}" method="POST" style="margin:0;">
          <button type="submit" class="popup-btn">Logout</button>
        </form>
      </div>
    </div>
  </div>
</header>

<section class="hero">
  <h2>Welcome, {{username}}, you‚Äôre not alone üíõ</h2>
  <p>SoulAce is your safe space to find support, resources, and connect with peers ‚Äî all while keeping things private and stigma-free.</p>
</section>

<section class="mood-tracker">
  <h2>How are you feeling?</h2>
  <div class="moods">
    <div class="mood-option" onclick="setMood('Very Happy')">
      <div class="mood-btn">üòÅ</div>
      <div class="label">Very Happy</div>
    </div>
    <div class="mood-option" onclick="setMood('Feeling Blessed')">
      <div class="mood-btn">üòá</div>
      <div class="label">Feeling Blessed</div>
    </div>
    <div class="mood-option" onclick="setMood('Happy')">
      <div class="mood-btn">üôÇ</div>
      <div class="label">Happy</div>
    </div>
    <div class="mood-option" onclick="setMood('Mind Blown')">
      <div class="mood-btn">ü§Ø</div>
      <div class="label">Mind Blown</div>
    </div>
    <div class="mood-option" onclick="setMood('Frustrated')">
      <div class="mood-btn">üò§</div>
      <div class="label">Frustrated</div>
    </div>
    <div class="mood-option" onclick="setMood('Sad')">
      <div class="mood-btn">üòî</div>
      <div class="label">Sad</div>
    </div>
    <div class="mood-option" onclick="setMood('Angry')">
      <div class="mood-btn">üò°</div>
      <div class="label">Angry</div>
    </div>
    <div class="mood-option" onclick="setMood('Crying')">
      <div class="mood-btn">üò≠</div>
      <div class="label">Crying</div>
    </div>
  </div>
  <form action="/download_chart" method="get">
    <button type="submit">üì• Download analysis</button>
  </form>
</section>


<section class="features">

  <a href="{{ url_for('chatbot_page') }}" class="feature-card">
    <span><img src="{{ url_for('static', filename='chatbot.png') }}"></span>
    <h3>AI Support</h3>
    <p>Chat with our AI guide for coping strategies and next steps.  </p>
  </a>

  <a href="{{ url_for('appointment') }}" class="feature-card">
    <span><img src="{{ url_for('static', filename='appointment.png') }}"></span>
    <h3>Confidential Booking</h3>
    <p>Book sessions with counsellors without fear of judgment.</p>
  </a>

    <a href="{{ url_for('assessment') }}" class="feature-card">
    <span><img src="{{ url_for('static', filename='assessment.png') }}"></span>
    <h3>Mental Health Assessment</h3>
    <p>Take a quick GAD-7 + PHQ-9 screening to track your mental health.</p>
  </a>

  <a href="{{ url_for('resources') }}" class="feature-card">
    <span><img src="{{ url_for('static', filename='wellness.png') }}"></span>
    <h3>Wellness Resources</h3>
    <p>Access guides, audios, and videos in your own language.</p>
  </a>

  <a href="{{ url_for('peer') }}" class="feature-card">
    <span><img src="{{ url_for('static', filename='peer support.png') }}"></span>
    <h3>Peer Support</h3>
    <p>Join moderated forums to share and support each other.</p>
  </a>

  <a href="{{ url_for('journal') }}" class="feature-card">
    <span><img src="{{ url_for('static', filename='journal.png') }}"></span>
    <h3>Journal</h3>
    <p>Pen down your thoughts and feelings of the day.</p>
  </a>
</section>
<button class="crisis-btn" id= "crisis-btn" type="button">üö® Crisis</button>

<footer>
  <p>SoulAce ¬© 2025 ‚Äî Built with üíô by Synapsix</p>
</footer>

<script>
async function sendCrisis() {
  
  try {
        const response = await fetch("/crisis", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            }
        });

        const result = await response.json();
        
        if (response.ok) {
            alert(result.message); // ‚úÖ Crisis logged successfully
        } else {
            alert(result.error || "Something went wrong");
        }
    } catch (err) {
        console.error("Error:", err);
        alert("Network error, try again!");
    }
  
  console.log("[client] clicking crisis...");


  // quick ping test first (uncomment to test separately)
  // const ping = await fetch("/ping");
  // console.log("ping status", ping.status, await ping.json());

  try {
    const res = await fetch("/send_email", {
      method: "POST",
      headers: { "Content-Type": "application/json" }
    });
    console.log("[client] /send_email HTTP status:", res.status);
    let data;
    try { data = await res.json(); } catch (e) { data = { ok: false, raw: "invalid-json" }; }
    console.log("[client] /send_email response body:", data);

    if (res.ok && data.ok) {
      alert("üìß Crisis email sent!");
    } else {
      alert("Failed to send: " + (data.error || JSON.stringify(data)));
    }
  } catch (err) {
    console.error("[client] fetch error:", err);
    alert("Fetch error: " + err);
  }
}

document.getElementById("crisis-btn").addEventListener("click", sendCrisis);
</script>


<script>
  function toggleMode(){ document.body.classList.toggle('dark'); }
function toggleUserPopup(){ const popup = document.getElementById('user-popup'); popup.style.display = popup.style.display==='block'?'none':'block'; }
async function setMood(mood){ const res = await fetch("/save_mood",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({mood})}); const r=await res.json(); alert(r.message);}
window.addEventListener('click', e=>{ const popup = document.getElementById('user-popup'); const icon = document.querySelector('.user-icon'); if(!popup.contains(e.target) && e.target!==icon) popup.style.display='none'; });

// Google Translate
function googleTranslateElementInit() {
  new google.translate.TranslateElement(
    {pageLanguage: 'en', includedLanguages: 'en,hi,ur'},
    'google_translate_element'
  );
}
// Language switcher
const langSelect=document.getElementById('lang-select');
langSelect.addEventListener('change', ()=>{
  const lang=langSelect.value;
  document.querySelectorAll('[data-en]').forEach(el=>{
    el.textContent=el.getAttribute('data-'+lang);
  });
});

    function toggleUserPopup() {
      const popup = document.getElementById('user-popup');
        popup.style.display = popup.style.display === 'block' ? 'none' : 'block';
      }
      
      async function setMood(mood) {
        const response = await fetch("/save_mood", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ mood: mood })
        });
        
        const result = await response.json();
      alert(result.message); // popup confirmation
    }

    
    // Optional: click outside to close
    window.addEventListener('click', function(e) {
      const popup = document.getElementById('user-popup');
      const icon = document.querySelector('.user-icon');
      if (!popup.contains(e.target) && e.target !== icon) {
        popup.style.display = 'none';
        }
    });
    
    async function triggerCrisis() {
      const response = await fetch("/crisis", { method: "POST" });
      const result = await response.json();
      alert(result.message);
    }

    document.getElementById("crisis-Btn").addEventListener("click", function() {
     fetch("/send_email", { method: "POST" })
     .then(res => res.json())
     .then(data => {
        if (data.ok) {
            alert("üìß Crisis email sent!");
        } else {
            alert("Failed: " + data.error);
        }
    })
    .catch(err => alert("Error: " + err));
});
    
</script>
<script src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
  </script>

</body>
</html>
