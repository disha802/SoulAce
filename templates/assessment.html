<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>SoulAce ‚Äî GAD7 + PHQ9</title>

<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root {
  --page-bg: #F5F7F2;
  --card-bg: #ffffff;
  --muted: #657A74;
  --accent: #3b82f6;
  --glass: rgba(0,0,0,0.02);
  --max-width: 1100px;
}

html, body { height:100%; margin:0; font-family:'Segoe UI', Roboto, system-ui, -apple-system, Arial; }
body { display:flex; flex-direction:column; min-height:100vh; margin:0; background:var(--page-bg); color:#333; transition:0.4s; }

header { display:flex; justify-content:space-between; align-items:center; padding:10px 20px; background-color:#7B9B8B; z-index:1000; }
.header-left { display:flex; align-items:center; gap:15px; }
.header-text { display:flex; flex-direction:column; }
.logo-container img { width:60px; height:60px; border-radius:50%; object-fit:cover; }
header h1 { margin:0; font-size:1.8rem; color:#fff; }
.header-text h3 { margin:0; font-size:1rem; font-weight:normal; color:#FFF7E4; }
.header-right { display:flex; align-items:center; gap:10px; position:relative; }
.user-icon { width:40px; height:40px; border-radius:50%; cursor:pointer; }

/* User popup updated */
.user-popup {
  display:none;
  position:absolute;
  top:50px;
  right:0;
  background:#fff;
  border-radius:12px;
  box-shadow:0 5px 15px rgba(0,0,0,0.2);
  padding:12px;
  z-index:100;
  min-width:220px;
  display:flex;
  flex-direction:column;
  gap:10px;
}

.user-popup .popup-btn {
  display:block;
  width:100%;
  padding:10px 14px;
  border:none;
  background:#3b82f6; /* Button background color */
  color:#fff;          /* Text color */
  border-radius:8px;
  text-align:left;     /* Left aligned text */
  cursor:pointer;
  font-weight:600;
  transition:0.2s;
}

.user-popup .popup-btn:hover {
  background:#2563eb;  /* Darker on hover */
}

#google_translate_element {
  margin-top:8px;
}

/* Container and layout */
.container { flex:1 0 auto; display:grid; grid-template-columns:1fr 380px; gap:18px; max-width: var(--max-width); width:100%; margin:0 auto; padding:28px 12px; }
@media (max-width:980px){ .container{grid-template-columns:1fr} }

footer { width:100%; flex-shrink:0; text-align:center; padding:1rem; font-size:0.9rem; background:#ffeecf; border-top:2px solid #fcd58d; margin-top:auto; }

.card{background:var(--card-bg);padding:20px;border-radius:12px;box-shadow:0 6px 22px rgba(30,40,40,0.06);border:1px solid rgba(0,0,0,0.03)}
.question-area { display:flex;flex-direction:column;gap:16px; }
.q-card{background:linear-gradient(180deg, #fff, #fbfcfb);padding:18px;border-radius:12px;border:1px solid rgba(0,0,0,0.03); }
.q-top{display:flex;justify-content:space-between;align-items:center}
.q-title{font-size:18px;font-weight:700}
.q-sub{color:var(--muted);font-size:13px}
.question-text{font-size:20px;margin:12px 0 8px 0;color:#102023}
.options{display:flex;gap:12px;flex-wrap:wrap}
.option{flex:1 1 45%;min-width:160px;padding:12px 14px;border-radius:10px;border:1px solid #e6e6e6;background:#fff;cursor:pointer;user-select:none}
.option .lab{font-weight:700;font-size:15px}
.option.selected{outline:3px solid rgba(59,130,246,0.12);box-shadow:0 8px 18px rgba(59,130,246,0.06)}
.controls{display:flex;justify-content:space-between;align-items:center;margin-top:12px}
.btn{padding:10px 14px;border-radius:8px;border:none;cursor:pointer;font-weight:700}
.btn.secondary{background:#f1f1f1;color:#243B36}
.btn.primary{background:var(--accent);color:#fff}
.progress{height:10px;background:#f0f2f1;border-radius:999px;overflow:hidden;margin-top:8px}
.progress > i{display:block;height:100%;width:0;background:linear-gradient(90deg,var(--accent), #60a5fa);transition:width .25s ease}

.summary-col{display:flex;flex-direction:column;gap:14px}
.score-summary{padding:14px;border-radius:10px;background:linear-gradient(180deg,#fff,#fbfcfb);border:1px solid rgba(0,0,0,0.03)}
.score-row{display:flex;justify-content:space-between;align-items:center}
.score-big{font-size:22px;font-weight:800}
.sev{font-weight:700;color:#3b3b3b}
.warn{color:#b45309;font-weight:800}
canvas{background:transparent;border-radius:8px}
.note{font-size:13px;color:var(--muted)}

body.dark-mode { background:#1f2937; color:#f3f4f6; }
body.dark-mode header { background:#374151; }
body.dark-mode .card { background:#111827; color:#f3f4f6; }
body.dark-mode .user-popup { background:#374151; color:#f3f4f6; }
body.dark-mode .btn.primary { background:#2563eb; color:#fff; }
body.dark-mode .btn.secondary { background:#6b7280; color:#fff; }
</style>

</head>
<body>

<header>
  <div class="header-left">
    <div class="logo-container">
      <img src="{{ url_for('static', filename='header-logo.png') }}" alt="SoulAce Logo">
    </div>
    <div class="header-text">
      <h1>SoulAce</h1>
      <h3>Wellness begins here.</h3>
    </div>
  </div>
  <div class="header-right">
    <div class="user-icon-container">
      <img src="{{ url_for('static', filename='user-icon.jpeg') }}" alt="User Icon" class="user-icon" onclick="toggleUserPopup()">
      <div id="user-popup" class="user-popup">
        <button class="popup-btn" onclick="toggleTranslateDropdown()">üåê Change Language</button>
        <div id="google_translate_element" style="display:none;"></div>
        <button class="popup-btn" onclick="window.location='/dashboard'">üè† Home</button>
        <button class="popup-btn" onclick="toggleDarkMode()">üåì Toggle Dark Mode</button>
        <form action="{{ url_for('logout') }}" method="POST" style="margin:0;">
          <button type="submit" class="popup-btn">üö™ Logout</button>
        </form>
      </div>
    </div>
  </div>
</header>

<div class="container">
  <!-- LEFT: questions -->
  <main class="card question-area" role="main">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div>
        <h1>Quick Mental Health Screen</h1>
        <p class="lead">GAD-7 + PHQ-9 ‚Äî How often in the last 2 weeks have you been bothered by these problems?</p>
      </div>
      <div style="text-align:right">
        <div class="note">Signed in as <strong id="uname">You</strong></div>
      </div>
    </div>
    <div id="questionContainer"></div>
    <div class="progress" aria-hidden="true"><i id="progressFill"></i></div>
    <div class="controls">
      <button id="backBtn" class="btn secondary">‚Üê Back</button>
      <div style="display:flex;gap:8px">
        <button id="saveBtn" class="btn" style="display:none">Save & Exit</button>
        <button id="nextBtn" class="btn primary">Next ‚Üí</button>
      </div>
    </div>
    <footer class="small">This is a screening tool only ‚Äî not a diagnostic. If PHQ-9 item 9 indicates suicidal ideation, please show crisis contacts immediately.</footer>
  </main>

  <!-- RIGHT: summary + charts -->
  <aside class="summary-col">
    <div class="card score-summary">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <div style="font-weight:800">Your Latest Scores</div>
          <div class="note">After you finish, charts will appear here.</div>
        </div>
        <div style="text-align:right">
          <div id="lastUpdate" class="note">‚Äî</div>
          <div style="font-size:12px;color:var(--muted)">Local</div>
        </div>
      </div>
      <div id="currentScoresArea" style="margin-top:12px;display:none">
        <div class="score-row">
          <div>
            <div class="note">Anxiety (GAD-7)</div>
            <div class="score-big" id="gadTotal">0</div>
            <div class="note" id="gadSeverity">Minimal</div>
          </div>
          <div>
            <div class="note">Depression (PHQ-9)</div>
            <div class="score-big" id="phqTotal">0</div>
            <div class="note" id="phqSeverity">None-Minimal</div>
          </div>
        </div>
        <div style="margin-top:10px">
          <button id="exportBtn" class="btn secondary">Copy results</button>
          <button id="viewHistoryBtn" class="btn primary">Refresh history</button>
        </div>
      </div>
    </div>
  </aside>
</div>

<footer>
  <p>SoulAce ¬© 2025 ‚Äî Built with üíô by SynapSix</p>
</footer>

<script>
document.addEventListener('DOMContentLoaded', () => {
  // USER DATA
  window.__USER_ID = "{{ session.get('user_id','') }}";
  const __USERNAME_FROM_SERVER = "{{ session.get('username','You')|e }}";
  document.getElementById('uname').textContent = __USERNAME_FROM_SERVER;

  // USER POPUP
  function toggleUserPopup(){
    const popup = document.getElementById('user-popup');
    popup.style.display = (popup.style.display==='block') ? 'none':'block';
  }
  document.querySelector('.user-icon').addEventListener('click', toggleUserPopup);
  document.addEventListener('click', function(e){
    const popup = document.getElementById('user-popup');
    const icon = document.querySelector('.user-icon');
    if(!popup.contains(e.target) && e.target!==icon){
      popup.style.display='none';
    }
  });

  // DARK MODE
  window.toggleDarkMode = function(){
    document.body.classList.toggle('dark-mode');
  }

  // GOOGLE TRANSLATE
  let translateLoaded = false;
  window.toggleTranslateDropdown = function(){
    const el = document.getElementById('google_translate_element');
    if(el.style.display==='block'){
      el.style.display='none';
    } else {
      el.style.display='block';
      if(!translateLoaded){
        new google.translate.TranslateElement({
          pageLanguage: 'en',
          includedLanguages: 'en,hi,ur',
          layout: google.translate.TranslateElement.InlineLayout.SIMPLE
        }, 'google_translate_element');
        translateLoaded = true;
      }
    }
  }

  // QUESTIONS
  const questions = [
    {id:'gad1', text:'Feeling nervous, anxious, or on edge.' , scale:'GAD'},
    {id:'gad2', text:'Not being able to stop or control worrying.' , scale:'GAD'},
    {id:'gad3', text:'Worrying too much about different things.' , scale:'GAD'},
    {id:'gad4', text:'Trouble relaxing.' , scale:'GAD'},
    {id:'gad5', text:'Being so restless that it is hard to sit still.' , scale:'GAD'},
    {id:'gad6', text:'Becoming easily annoyed or irritable.' , scale:'GAD'},
    {id:'gad7', text:'Feeling afraid as if something awful might happen.' , scale:'GAD'},
    {id:'phq1', text:'Little interest or pleasure in doing things.' , scale:'PHQ'},
    {id:'phq2', text:'Feeling down, depressed, or hopeless.' , scale:'PHQ'},
    {id:'phq3', text:'Trouble falling or staying asleep, or sleeping too much.' , scale:'PHQ'},
    {id:'phq4', text:'Feeling tired or having little energy.' , scale:'PHQ'},
    {id:'phq5', text:'Poor appetite or overeating.' , scale:'PHQ'},
    {id:'phq6', text:'Feeling bad about yourself or that you are a failure or have let yourself or your family down.' , scale:'PHQ'},
    {id:'phq7', text:'Trouble concentrating on things.' , scale:'PHQ'},
    {id:'phq8', text:'Moving or speaking slowly OR being fidgety/restless.' , scale:'PHQ'},
    {id:'phq9', text:'Thoughts that you would be better off dead, or of hurting yourself.' , scale:'PHQ'}
  ];
  const options = [
    {label:'Not at all', score:0},
    {label:'Several days', score:1},
    {label:'More than half the days', score:2},
    {label:'Nearly every day', score:3}
  ];

  let answers = new Array(questions.length).fill(null);
  let curIndex = 0;
  const qCon = document.getElementById('questionContainer');
  const progressFill = document.getElementById('progressFill');
  const backBtn = document.getElementById('backBtn');
  const nextBtn = document.getElementById('nextBtn');

  function renderQuestions(){
    qCon.innerHTML = '';
    questions.forEach((q, idx)=>{
      const el = document.createElement('div');
      el.className='q-card';
      el.style.display=(idx===curIndex?'block':'none');
      el.dataset.index=idx;
      el.innerHTML=`
        <div class="q-top">
          <div>
            <div class="q-title">Question ${idx+1} of ${questions.length}</div>
            <div class="q-sub">${q.scale==='GAD'?'GAD-7':'PHQ-9'}</div>
          </div>
          <div class="q-sub">${q.scale}</div>
        </div>
        <div class="question-text">${q.text}</div>
        <div class="options"></div>
      `;
      const optsWrap=el.querySelector('.options');
      options.forEach(op=>{
        const btn=document.createElement('div');
        btn.className='option';
        btn.innerHTML=`<div class="lab">${op.label}</div>`;
        btn.addEventListener('click', ()=>{
          answers[idx]=op.score;
          optsWrap.querySelectorAll('.option').forEach(o=>o.classList.remove('selected'));
          btn.classList.add('selected');
          setTimeout(()=>{ if(curIndex<questions.length-1){ curIndex++; updateView(); } }, 220);
        });
        optsWrap.appendChild(btn);
      });
      qCon.appendChild(el);
    });
    updateView();
  }

  function updateView(){
    document.querySelectorAll('.q-card').forEach(card=>{
      const i=Number(card.dataset.index);
      card.style.display=(i===curIndex)?'block':'none';
    });
    backBtn.disabled=curIndex===0;
    nextBtn.textContent=(curIndex===questions.length-1)?'Submit':'Next ‚Üí';
    const answered = answers.filter(a=>a!==null).length;
    progressFill.style.width = Math.round((answered/questions.length)*100)+'%';
  }

  backBtn.addEventListener('click', ()=>{ if(curIndex>0) curIndex--; updateView(); });
  nextBtn.addEventListener('click', ()=>{ if(curIndex===questions.length-1){ alert('Submit logic here'); return;} curIndex++; updateView(); });

  renderQuestions();
});
</script>

<script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

</body>
</html>
